<?phpnamespace common\models\score;use common\models\user\User;use Yii;/** * This is the model class for table "score_invest". * * @property int $id * @property int $user_id * @property string $num * @property double $fund */class ScoreInvest extends \yii\db\ActiveRecord{    /**     * @inheritdoc     */    public static function tableName()    {        return 'score_invest';    }    /**     * @inheritdoc     */    public function rules()    {        return [            [['user_id', 'num'], 'required'],            [['user_id'], 'integer'],            [['fund'], 'number'],            [['num'], 'string', 'max' => 50],        ];    }    /**     * @inheritdoc     */    public function attributeLabels()    {        return [            'id' => 'ID',            'user_id' => '投资者ID',            'num' => '队伍',            'fund' => '资金',        ];    }    /**     * 合计投资排名     * @return array     */    static public function rankSum(){        //拼接语句        $sql = "SELECT num,SUM(fund) as sum";        $sql .= " FROM ".self::tableName();        $sql .= " group by num";        $sql .= " order by sum desc";        //返回结果        $command = Yii::$app->db->createCommand($sql);        $list = $command->queryAll();        return $list;    }    /**     * 添加投资记录前，扣除用户余额     * @param bool $insert     * @return bool     */    public function beforeSave($insert)    {        //添加投资记录前，扣除用户余额        if($insert){            $user = User::findOne($this->user_id);            $this->fund = ($user->fund >= $this->fund) ? $this->fund : $user->fund;            $user->fund = $user->fund - $this->fund;            $user->save();        }        return parent::beforeSave($insert); // TODO: Change the autogenerated stub    }    /**     * 获取已经投资列表     * @param $user_id     * @return static[]     */    static public function getInvestList($user_id){        $list = self::findAll(["user_id" => $user_id]);        return $list;    }}